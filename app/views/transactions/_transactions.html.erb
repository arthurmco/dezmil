<%if @d %><h1><%= link_to @d.strftime("%B"), "/transactions/#{@d.year}/#{@d.month}/", class: 'no-text-decoration' %></h1><% end %>
<% unless @transactions.nil? %>
  Categorizado:
<div class="progress">
  <% if @progress %>
    <div class="progress-bar bg-success" style="width: <%= @progress %>%">
      <% if @progress > 10 %><%= @progress %>%<% end %>
    </div>
  <% end %>
</div>
<% end %>
<% if @transactions.count > 0 %>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">Data</th>
      <th scope="col">Memo</th>
      <th scope="col"></th>
      <th scope="col">Categoria</th>
      <th scope="col">Saldo</th>
      <th scope="col">Credito</th>
      <th scope="col">Debito</th>
    </tr> 
  </thead>
  <tbody>
    <% @transactions.each do |t| %>
      <tr>
        <td><%= t.date %></td>
        <td>
          <%= link_to "#{t.memo}", "/transactions/#{@d.year}/#{@d.month}/fuzzy/?pattern=".html_safe + t.memo, class: 'no-text-decoration' %>
        </td>
        <td class='status'>
          <%= fa_icon 'check-circle', class: 'hidden success' %>
          <%= fa_icon 'exclamation-circle', class: 'hidden failure' %>
          <%= fa_icon 'spinner', class: 'loading hidden' %>
        </td>
        <td class='category'>
          <%= select_tag 'category',
            categories(t).html_safe,
            class: 'category-select custom-select',
            'data-transaction' => t.id.to_s,
            style: "background-color: #{t.category&.color || 'white'}",
            id: nil
          %>
        </td>
        <td><%= t.balance %></td>
        <td><%= t.credit %></td>
        <td><%= t.debit %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<% unless @grouped %>
<table class="table table-hover">
  <thead>
    <tr>
      <th></th>
      <th>Credito</th>
      <th>Debito</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Total</th>
      <td id='total-credit'><%= @transactions.where('transactions.amount > 0').sum('transactions.amount') %></td>
      <td id='total-debit'><%= @transactions.where('transactions.amount <= 0').sum('transactions.amount') %></td>
    </tr>
  </tbody>
</table>
<% end %>
<% else %>
  Sem dados!
<% end %>
